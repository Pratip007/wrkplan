<!-- Floating Chat Button -->
<div class="fixed bottom-6 right-6 z-50">
  <!-- Chat Toggle Button -->
  <button
    (click)="toggleChat()"
    class="w-16 h-16 bg-[#074e94] hover:bg-[#074e94]/90 text-white rounded-full shadow-2xl hover:shadow-3xl transition-all duration-300 transform hover:scale-110 flex items-center justify-center group"
    [class.animate-pulse]="!isOpen">

    <!-- Chat Icon -->
    <div class="relative">
      <img src="/assects/chatbot-logo.svg" alt="WRKPLAN Assistant" class="w-8 h-8">

      <!-- Notification Dot -->
      <div class="absolute -top-1 -right-1 w-3 h-3 bg-[#91c754] rounded-full animate-ping"></div>
    </div>
  </button>

  <!-- Chat Interface -->
  <div
    *ngIf="isOpen"
    class="absolute bottom-20 right-0 w-80 h-96 bg-white rounded-2xl shadow-2xl border border-gray-200 flex flex-col transition-all duration-300 transform scale-100">

    <!-- Chat Header -->
    <div class="bg-[#074e94] text-white p-4 rounded-t-2xl flex items-center justify-between">
      <div class="flex items-center space-x-3">
        <!-- Bot Avatar -->
        <div class="w-10 h-10 rounded-full flex items-center justify-center overflow-hidden">
          <img src="/assects/chatbot-logo.svg" alt="WRKPLAN Assistant" class="w-full h-full object-cover">
        </div>
        <div>
          <h3 class="font-semibold text-lg">WRKPLAN Assistant</h3>
          <p class="text-sm opacity-90">DCAA Compliance Expert</p>
        </div>
      </div>

      <!-- Close Button -->
      <button
        (click)="toggleChat()"
        class="text-white hover:text-gray-200 transition-colors duration-200">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
        </svg>
      </button>
    </div>

    <!-- Chat Messages -->
    <div
      #chatContainer
      class="flex-1 p-4 overflow-y-auto space-y-4 bg-gray-50">

      <div
        *ngFor="let message of messages"
        class="flex"
        [class.justify-end]="message.isUser">

        <!-- User Message -->
        <div
          *ngIf="message.isUser"
          class="max-w-xs lg:max-w-md bg-[#074e94] text-white p-3 rounded-2xl rounded-br-md">
          <p class="text-sm">{{ message.text }}</p>
          <p class="text-xs opacity-70 mt-1">{{ message.timestamp | date:'shortTime' }}</p>
        </div>

        <!-- Bot Message -->
        <div
          *ngIf="!message.isUser"
          class="max-w-xs lg:max-w-md bg-white text-gray-800 p-3 rounded-2xl rounded-bl-md shadow-sm border border-gray-200">
          <p class="text-sm">{{ message.text }}</p>
          <p class="text-xs text-gray-500 mt-1">{{ message.timestamp | date:'shortTime' }}</p>
        </div>
      </div>

      <!-- Typing Indicator -->
      <div
        *ngIf="isTyping"
        class="flex justify-start">
        <div class="bg-white text-gray-800 p-3 rounded-2xl rounded-bl-md shadow-sm border border-gray-200">
          <div class="flex space-x-1">
            <div class="w-2 h-2 bg-gray-400 rounded-full animate-bounce"></div>
            <div class="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style="animation-delay: 0.1s"></div>
            <div class="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style="animation-delay: 0.2s"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- Message Input -->
    <div class="p-4 border-t border-gray-200 bg-white rounded-b-2xl">
      <div class="flex space-x-2">
        <input
          #messageInput
          type="text"
          [(ngModel)]="currentMessage"
          (keypress)="onKeyPress($event)"
          placeholder="Type your message..."
          class="flex-1 px-4 py-2 border border-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-[#074e94] focus:border-transparent text-sm">

        <button
          (click)="sendMessage()"
          [disabled]="!currentMessage.trim()"
          class="w-10 h-10 bg-[#074e94] hover:bg-[#074e94]/90 disabled:bg-gray-300 text-white rounded-full flex items-center justify-center transition-colors duration-200 disabled:cursor-not-allowed">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path>
          </svg>
        </button>
      </div>

      <!-- Quick Actions -->
      <div class="flex flex-wrap gap-2 mt-3">
        <button
          (click)="addUserMessage('DCAA compliance')"
          class="px-3 py-1 bg-gray-100 hover:bg-gray-200 text-gray-700 text-xs rounded-full transition-colors duration-200">
          DCAA
        </button>
        <button
          (click)="addUserMessage('demo')"
          class="px-3 py-1 bg-gray-100 hover:bg-gray-200 text-gray-700 text-xs rounded-full transition-colors duration-200">
          Demo
        </button>
        <button
          (click)="addUserMessage('pricing')"
          class="px-3 py-1 bg-gray-100 hover:bg-gray-200 text-gray-700 text-xs rounded-full transition-colors duration-200">
          Pricing
        </button>
        <button
          (click)="addUserMessage('contact')"
          class="px-3 py-1 bg-gray-100 hover:bg-gray-200 text-gray-700 text-xs rounded-full transition-colors duration-200">
          Contact
        </button>
      </div>
    </div>
  </div>
</div>
